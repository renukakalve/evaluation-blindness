# -*- coding: utf-8 -*-
"""CIFAR-10-C.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1KAlnMBzSweQU_Ob044ROvkZLwoOq4855
"""

import numpy as np
import torch
import torch
import torch.nn as nn
from torchvision import models

data = np.load("gaussian_noise.npy")
labels = np.load("labels.npy")

data = torch.tensor(data).permute(0,3,1,2).float() / 255.0
labels = torch.tensor(labels)

device = torch.device("cuda" if torch.cuda.is_available() else "cpu")

model = models.resnet18(pretrained=False)
model.fc = nn.Linear(model.fc.in_features, 10)
model = model.to(device)

torch.save(model.state_dict(), "resnet18_cifar10.pth")

model.eval()
correct = 0
total = 0

with torch.no_grad():
    for i in range(len(data)):
        image = data[i].unsqueeze(0).to(device)
        label = labels[i].to(device)

        output = model(image)
        pred = output.argmax(dim=1)

        correct += (pred == label).item()
        total += 1

accuracy = 100 * correct / total
print("CIFAR-10-C Accuracy:", accuracy)